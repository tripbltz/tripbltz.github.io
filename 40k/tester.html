<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warhammer 40K Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            color: #fff;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(90deg, #8B0000, #4B0000);
            padding: 1rem;
            text-align: center;
            border-bottom: 3px solid #FFD700;
        }

        .header h1 {
            font-size: 2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .setup-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            gap: 1rem;
            min-height: calc(100vh - 120px);
        }

        .setup-form {
            background: rgba(0,0,0,0.7);
            padding: 2rem;
            border-radius: 10px;
            border: 2px solid #FFD700;
            max-width: 600px;
            width: 100%;
        }

        .setup-form h2 {
            color: #FFD700;
            margin-bottom: 1rem;
            text-align: center;
        }

        .player-setup {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .player-form {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 8px;
        }

        .player-form h3 {
            color: #FFD700;
            margin-bottom: 1rem;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #FFD700;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #666;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 1rem;
        }

        .form-group input::placeholder {
            color: #aaa;
        }

        .setup-buttons {
            text-align: center;
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(45deg, #8B0000, #DC143C);
            color: #fff;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .btn:hover {
            background: linear-gradient(45deg, #DC143C, #FF6347);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4B0082, #6A5ACD);
        }

        .btn-secondary:hover {
            background: linear-gradient(45deg, #6A5ACD, #9370DB);
        }

        .game-container {
            display: none;
            padding: 1rem;
            gap: 1rem;
            grid-template-columns: 1fr 300px;
            height: calc(100vh - 120px);
        }

        .main-game {
            display: grid;
            grid-template-rows: auto 1fr;
            gap: 1rem;
        }

        .phase-tracker {
            background: rgba(0,0,0,0.8);
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid #FFD700;
        }

        .phase-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .phase {
            background: rgba(255,255,255,0.1);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            border: 1px solid #666;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
            margin: 0 2px;
        }

        .phase.active {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            border-color: #FFD700;
            transform: scale(1.05);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        .turn-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .players-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            height: 100%;
        }

        .player-panel {
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            border: 2px solid #666;
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }

        .player-panel.active {
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255,215,0,0.3);
        }

        .player-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #666;
        }

        .player-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #8B0000, #DC143C);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .player-stats {
            flex: 1;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .units-section {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .unit-card {
            background: rgba(255,255,255,0.1);
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 5px;
            border-left: 4px solid #FFD700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .unit-card:hover {
            background: rgba(255,215,0,0.1);
            transform: translateX(5px);
        }

        .unit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .unit-name {
            font-weight: bold;
            color: #FFD700;
        }

        .unit-wounds {
            display: flex;
            gap: 0.25rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .wound-pip {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00FF00;
            border: 1px solid #fff;
        }

        .wound-pip.lost {
            background: #FF0000;
        }

        .actions-section {
            border-top: 1px solid #666;
            padding-top: 1rem;
        }

        .action-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .action-input input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #666;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .dice-section {
            background: rgba(0,0,0,0.8);
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid #4B0082;
        }

        .dice-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .dice-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #666;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .dice-results {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 5px;
            margin-top: 1rem;
            min-height: 100px;
        }

        .dice-visual {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .die {
            width: 30px;
            height: 30px;
            background: #fff;
            color: #000;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid #000;
        }

        .log-section {
            background: rgba(0,0,0,0.8);
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid #008000;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .log-content {
            flex: 1;
            overflow-y: auto;
            background: rgba(255,255,255,0.05);
            padding: 0.5rem;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 400px;
        }

        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem;
            border-left: 2px solid #FFD700;
            padding-left: 0.5rem;
        }

        .log-timestamp {
            color: #888;
            font-size: 0.8rem;
        }

        .hidden {
            display: none !important;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            padding: 2rem;
            border-radius: 10px;
            border: 2px solid #FFD700;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #FFD700;
        }

        .unit-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .unit-option {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 5px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .unit-option:hover {
            border-color: #FFD700;
            background: rgba(255,215,0,0.1);
        }

        .unit-option.selected {
            border-color: #00FF00;
            background: rgba(0,255,0,0.1);
        }

        .unit-action-card {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid #666;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .unit-action-card:hover {
            border-color: #FFD700;
            background: rgba(255,215,0,0.1);
            transform: translateY(-2px);
        }

        .unit-action-card h4 {
            color: #FFD700;
            margin-bottom: 0.5rem;
        }

        .stratagem-section {
            background: rgba(0,0,0,0.8);
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid #8B0000;
            margin-bottom: 1rem;
        }

        .stratagem-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .stratagem-card {
            background: rgba(139,0,0,0.3);
            padding: 0.75rem;
            border-radius: 5px;
            border: 1px solid #8B0000;
            cursor: pointer;
            transition: all 0.3s;
        }

        .stratagem-card:hover {
            border-color: #FFD700;
            background: rgba(255,215,0,0.1);
        }

        .stratagem-name {
            font-weight: bold;
            color: #FFD700;
            font-size: 0.9rem;
        }

        .stratagem-cost {
            color: #FF6347;
            font-size: 0.8rem;
        }

        .stratagem-desc {
            color: #ccc;
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .faction-rules {
            background: rgba(75,0,130,0.3);
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid #4B0082;
            margin-bottom: 1rem;
        }

        .objective-tracker {
            background: rgba(0,100,0,0.3);
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid #006400;
            margin-bottom: 1rem;
        }

        .objective-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .objective {
            background: rgba(255,255,255,0.1);
            padding: 0.5rem;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            border: 2px solid #666;
            transition: all 0.3s;
        }

        .objective.player1 {
            border-color: #FFD700;
            background: rgba(255,215,0,0.2);
        }

        .objective.player2 {
            border-color: #FF6347;
            background: rgba(255,99,71,0.2);
        }

        .combat-tracker {
            background: rgba(139,0,0,0.3);
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid #8B0000;
            margin-bottom: 1rem;
        }

        .combat-roll-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .roll-category {
            background: rgba(255,255,255,0.1);
            padding: 0.75rem;
            border-radius: 5px;
        }

        .roll-inputs {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .roll-inputs input {
            padding: 0.25rem;
            border: 1px solid #666;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 0.8rem;
        }

        @media (max-width: 768px) {
            .game-container {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr auto;
            }
            
            .players-area {
                grid-template-columns: 1fr;
            }
            
            .player-setup {
                grid-template-columns: 1fr;
            }
            
            .combat-roll-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚öîÔ∏è WARHAMMER 40,000 BATTLE ASSISTANT ‚öîÔ∏è</h1>
    </div>

    <!-- Setup Screen -->
    <div id="setupScreen" class="setup-screen">
        <div class="setup-form">
            <h2>üõ°Ô∏è Battle Preparation</h2>
            <div class="player-setup">
                <div class="player-form">
                    <h3>Player 1</h3>
                    <div class="roll-category">
                        <h4 style="color: #FFD700; font-size: 0.9rem;">Wound Rolls</h4>
                        <div class="roll-inputs">
                            <input type="text" placeholder="S vs T" id="woundStr">
                            <input type="text" placeholder="Target" id="woundTarget">
                            <input type="text" placeholder="# dice" id="woundDice">
                        </div>
                        <button class="btn" style="width: 100%; margin-top: 0.5rem; padding: 0.25rem;" onclick="rollToWound()">Roll to Wound</button>
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <div class="roll-category">
                        <h4 style="color: #FFD700; font-size: 0.9rem;">Save Rolls</h4>
                        <div class="roll-inputs">
                            <input type="text" placeholder="Save value" id="saveValue">
                            <input type="text" placeholder="AP modifier" id="saveAP">
                            <input type="text" placeholder="# dice" id="saveDice">
                        </div>
                        <button class="btn" style="width: 100%; margin-top: 0.5rem; padding: 0.25rem;" onclick="rollSaves()">Roll Saves</button>
                    </div>
                </div>
            </div>

            <!-- Dice Section -->
            <div class="dice-section">
                <h3>üé≤ Dice Roller</h3>
                <div class="dice-controls">
                    <input type="text" class="dice-input" id="diceInput" placeholder="e.g., '6d6', '3d3', '2d6+1'" />
                    <button class="btn" onclick="rollDice()">Roll</button>
                </div>
                <div class="dice-results" id="diceResults">
                    <div style="text-align: center; color: #888;">Enter dice notation and click Roll</div>
                </div>
            </div>

            <!-- Game Log -->
            <div class="log-section">
                <h3>üìú Battle Log</h3>
                <div class="log-content" id="gameLog">
                    <div class="log-entry">
                        <div class="log-timestamp">Turn 1 - Command Phase</div>
                        <div>Battle begins! Emperor protects!</div>
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <button class="btn btn-secondary" onclick="clearLog()">Clear Log</button>
                    <button class="btn btn-secondary" onclick="exportLog()" style="margin-left: 0.5rem;">Export</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Unit database
        const unitDatabase = {
            'space-marines': [
                { name: 'Tactical Squad', wounds: 2, models: 10, save: 3, invuln: null, leadership: 6, role: 'Battleline', movement: 6, bs: 3, ws: 3, strength: 4, toughness: 4, attacks: 2, keywords: ['Infantry', 'Battleline'], abilities: ['Oath of Moment'] },
                { name: 'Assault Intercessors', wounds: 2, models: 10, save: 3, invuln: null, leadership: 6, role: 'Close Support', movement: 6, bs: 3, ws: 3, strength: 4, toughness: 4, attacks: 3, keywords: ['Infantry'], abilities: ['Oath of Moment'] },
                { name: 'Captain', wounds: 6, models: 1, save: 2, invuln: 4, leadership: 6, role: 'Character', movement: 6, bs: 2, ws: 2, strength: 4, toughness: 5, attacks: 5, keywords: ['Infantry', 'Character'], abilities: ['Oath of Moment', 'Leader'] }
            ],
            'imperial-guard': [
                { name: 'Infantry Squad', wounds: 1, models: 10, save: 5, invuln: null, leadership: 7, role: 'Battleline', movement: 6, bs: 4, ws: 4, strength: 3, toughness: 3, attacks: 1, keywords: ['Infantry', 'Regiment'], abilities: ['Voice of Command'] },
                { name: 'Heavy Weapons Squad', wounds: 2, models: 3, save: 5, invuln: null, leadership: 7, role: 'Fire Support', movement: 6, bs: 4, ws: 4, strength: 3, toughness: 3, attacks: 1, keywords: ['Infantry', 'Regiment'], abilities: ['Voice of Command'] },
                { name: 'Company Commander', wounds: 3, models: 1, save: 5, invuln: null, leadership: 8, role: 'Character', movement: 6, bs: 3, ws: 3, strength: 3, toughness: 3, attacks: 3, keywords: ['Infantry', 'Character', 'Officer'], abilities: ['Voice of Command', 'Leader'] }
            ],
            'orks': [
                { name: 'Boyz', wounds: 1, models: 10, save: 6, invuln: null, leadership: 6, role: 'Battleline', movement: 6, bs: 5, ws: 3, strength: 4, toughness: 4, attacks: 2, keywords: ['Infantry', 'Mob'], abilities: ['Waaagh!'] },
                { name: 'Nobz', wounds: 2, models: 5, save: 4, invuln: null, leadership: 6, role: 'Elite', movement: 6, bs: 5, ws: 3, strength: 5, toughness: 5, attacks: 3, keywords: ['Infantry'], abilities: ['Waaagh!'] },
                { name: 'Warboss', wounds: 6, models: 1, save: 4, invuln: null, leadership: 6, role: 'Character', movement: 6, bs: 5, ws: 2, strength: 6, toughness: 5, attacks: 5, keywords: ['Infantry', 'Character'], abilities: ['Waaagh!', 'Leader'] }
            ],
            'necrons': [
                { name: 'Necron Warriors', wounds: 1, models: 10, save: 4, invuln: null, leadership: 10, role: 'Battleline', movement: 5, bs: 4, ws: 4, strength: 4, toughness: 4, attacks: 1, keywords: ['Infantry'], abilities: ['Reanimation Protocols'] },
                { name: 'Immortals', wounds: 1, models: 10, save: 3, invuln: null, leadership: 10, role: 'Battleline', movement: 5, bs: 3, ws: 4, strength: 4, toughness: 5, attacks: 1, keywords: ['Infantry'], abilities: ['Reanimation Protocols'] },
                { name: 'Overlord', wounds: 6, models: 1, save: 3, invuln: 4, leadership: 10, role: 'Character', movement: 5, bs: 3, ws: 2, strength: 6, toughness: 6, attacks: 4, keywords: ['Infantry', 'Character'], abilities: ['Reanimation Protocols', 'Leader'] }
            ],
            'tau': [
                { name: 'Fire Warriors', wounds: 1, models: 10, save: 4, invuln: null, leadership: 7, role: 'Battleline', movement: 6, bs: 4, ws: 5, strength: 3, toughness: 3, attacks: 1, keywords: ['Infantry'], abilities: ['For the Greater Good'] },
                { name: 'Crisis Battlesuits', wounds: 3, models: 3, save: 3, invuln: null, leadership: 7, role: 'Elite', movement: 10, bs: 4, ws: 5, strength: 5, toughness: 5, attacks: 2, keywords: ['Battlesuit', 'Fly'], abilities: ['For the Greater Good'] },
                { name: 'Commander', wounds: 5, models: 1, save: 3, invuln: null, leadership: 8, role: 'Character', movement: 10, bs: 2, ws: 5, strength: 5, toughness: 5, attacks: 3, keywords: ['Battlesuit', 'Character'], abilities: ['For the Greater Good', 'Leader'] }
            ],
            'eldar': [
                { name: 'Guardian Defenders', wounds: 1, models: 10, save: 4, invuln: null, leadership: 6, role: 'Battleline', movement: 7, bs: 3, ws: 4, strength: 3, toughness: 3, attacks: 1, keywords: ['Infantry', 'Guardians'], abilities: ['Battle Focus'] },
                { name: 'Dire Avengers', wounds: 1, models: 10, save: 4, invuln: 5, leadership: 6, role: 'Battleline', movement: 7, bs: 3, ws: 3, strength: 3, toughness: 3, attacks: 2, keywords: ['Infantry', 'Aspect Warriors'], abilities: ['Battle Focus'] },
                { name: 'Farseer', wounds: 4, models: 1, save: 6, invuln: 4, leadership: 6, role: 'Character', movement: 7, bs: 3, ws: 3, strength: 3, toughness: 3, attacks: 2, keywords: ['Infantry', 'Character', 'Psyker'], abilities: ['Battle Focus', 'Leader'] }
            ],
            'dark-eldar': [
                { name: 'Kabalite Warriors', wounds: 1, models: 10, save: 4, invuln: null, leadership: 6, role: 'Battleline', movement: 8, bs: 3, ws: 3, strength: 3, toughness: 3, attacks: 1, keywords: ['Infantry', 'Kabal'], abilities: ['Power from Pain'] },
                { name: 'Wyches', wounds: 1, models: 10, save: 6, invuln: 4, leadership: 6, role: 'Elite', movement: 8, bs: 4, ws: 3, strength: 3, toughness: 3, attacks: 3, keywords: ['Infantry', 'Wych Cult'], abilities: ['Power from Pain'] },
                { name: 'Archon', wounds: 5, models: 1, save: 5, invuln: 4, leadership: 7, role: 'Character', movement: 8, bs: 2, ws: 2, strength: 3, toughness: 3, attacks: 5, keywords: ['Infantry', 'Character'], abilities: ['Power from Pain', 'Leader'] }
            ],
            'chaos-marines': [
                { name: 'Chaos Space Marines', wounds: 2, models: 10, save: 3, invuln: null, leadership: 6, role: 'Battleline', movement: 6, bs: 3, ws: 3, strength: 4, toughness: 4, attacks: 2, keywords: ['Infantry', 'Chaos'], abilities: ['Dark Pacts'] },
                { name: 'Chaos Cultists', wounds: 1, models: 10, save: 6, invuln: null, leadership: 5, role: 'Battleline', movement: 6, bs: 4, ws: 4, strength: 3, toughness: 3, attacks: 1, keywords: ['Infantry', 'Cultists'], abilities: ['Expendable'] },
                { name: 'Chaos Lord', wounds: 6, models: 1, save: 3, invuln: 4, leadership: 7, role: 'Character', movement: 6, bs: 2, ws: 2, strength: 4, toughness: 5, attacks: 5, keywords: ['Infantry', 'Character'], abilities: ['Dark Pacts', 'Leader'] }
            ],
            'tyranids': [
                { name: 'Termagants', wounds: 1, models: 10, save: 5, invuln: null, leadership: 8, role: 'Battleline', movement: 6, bs: 4, ws: 4, strength: 3, toughness: 3, attacks: 1, keywords: ['Infantry'], abilities: ['Synapse'] },
                { name: 'Genestealers', wounds: 1, models: 10, save: 5, invuln: 5, leadership: 8, role: 'Elite', movement: 8, bs: 4, ws: 3, strength: 4, toughness: 4, attacks: 3, keywords: ['Infantry'], abilities: ['Synapse'] },
                { name: 'Hive Tyrant', wounds: 10, models: 1, save: 3, invuln: 4, leadership: 10, role: 'Character', movement: 8, bs: 3, ws: 2, strength: 6, toughness: 9, attacks: 5, keywords: ['Monster', 'Character'], abilities: ['Synapse', 'Leader'] }
            ]
        };

        // Stratagems database
        const stratagemDatabase = {
            'space-marines': [
                { name: 'Overwatch', cost: 1, phase: 'any', description: 'Fire at charging enemies' },
                { name: 'Transhuman Physiology', cost: 1, phase: 'any', description: 'Wounds of 1-3 fail against target unit' },
                { name: 'Rapid Fire', cost: 1, phase: 'shooting', description: 'Double shots with rapid fire weapons' }
            ],
            'imperial-guard': [
                { name: 'Overwatch', cost: 1, phase: 'any', description: 'Fire at charging enemies' },
                { name: 'Take Aim!', cost: 1, phase: 'shooting', description: 'Re-roll hit rolls of 1' },
                { name: 'Fix Bayonets!', cost: 1, phase: 'fight', description: '+1 attack when charged' }
            ],
            'orks': [
                { name: 'Overwatch', cost: 1, phase: 'any', description: 'Fire at charging enemies' },
                { name: "Ere We Go!", cost: 1, phase: 'charge', description: 'Re-roll charge distance' },
                { name: 'More Dakka!', cost: 1, phase: 'shooting', description: 'Extra shots on 6s to hit' }
            ],
            'necrons': [
                { name: 'Overwatch', cost: 1, phase: 'any', description: 'Fire at charging enemies' },
                { name: 'Reclamation Legion', cost: 1, phase: 'command', description: 'Extra Reanimation Protocol roll' },
                { name: 'Quantum Shielding', cost: 1, phase: 'any', description: 'Halve damage against vehicles' }
            ],
            'tau': [
                { name: 'Overwatch', cost: 1, phase: 'any', description: 'Fire at charging enemies' },
                { name: 'For the Greater Good', cost: 1, phase: 'shooting', description: 'Supporting fire from nearby units' },
                { name: 'Coordinated Engagement', cost: 1, phase: 'shooting', description: 'Multiple units target same enemy' }
            ],
            'eldar': [
                { name: 'Overwatch', cost: 1, phase: 'any', description: 'Fire at charging enemies' },
                { name: 'Fire and Fade', cost: 2, phase: 'shooting', description: 'Move after shooting' },
                { name: 'Bladestorm', cost: 1, phase: 'shooting', description: 'Shuriken weapons get extra AP' }
            ],
            'dark-eldar': [
                { name: 'Overwatch', cost: 1, phase: 'any', description: 'Fire at charging enemies' },
                { name: 'Prey on the Weak', cost: 1, phase: 'shooting', description: 'Extra damage vs wounded units' },
                { name: 'Cruel Deception', cost: 1, phase: 'fight', description: 'Fight first when charged' }
            ],
            'chaos-marines': [
                { name: 'Overwatch', cost: 1, phase: 'any', description: 'Fire at charging enemies' },
                { name: 'Veterans of the Long War', cost: 1, phase: 'shooting', description: '+1 to wound vs Imperium' },
                { name: 'Daemonic Vigour', cost: 1, phase: 'any', description: 'Feel no pain 5+' }
            ],
            'tyranids': [
                { name: 'Overwatch', cost: 1, phase: 'any', description: 'Fire at charging enemies' },
                { name: 'Rapid Regeneration', cost: 1, phase: 'command', description: 'Heal D3 wounds' },
                { name: 'Metabolic Overdrive', cost: 1, phase: 'movement', description: 'Advance and charge' }
            ]
        };

        // Faction rules
        const factionRules = {
            'space-marines': {
                name: 'Oath of Moment',
                description: 'At start of Command phase, select enemy unit. All Space Marines get +1 to hit against that unit.',
                detachmentRule: 'Combat Doctrines'
            },
            'imperial-guard': {
                name: 'Voice of Command',
                description: 'Officers can issue orders to nearby Infantry units.',
                detachmentRule: 'Combined Arms'
            },
            'orks': {
                name: 'Waaagh!',
                description: 'Once per battle, declare Waaagh! All Orks get +1 attack and +1 to charge rolls.',
                detachmentRule: 'Green Tide'
            },
            'necrons': {
                name: 'Reanimation Protocols',
                description: 'When a model is destroyed, roll a die. On a 5+, return with 1 wound remaining.',
                detachmentRule: 'Awakened Dynasty'
            },
            'tau': {
                name: 'For the Greater Good',
                description: 'Supporting Fire allows multiple units to shoot at charging enemies.',
                detachmentRule: 'Coordinated Firepower'
            },
            'eldar': {
                name: 'Battle Focus',
                description: 'Units can shoot and then move D6" if they did not advance.',
                detachmentRule: 'Strands of Fate'
            },
            'dark-eldar': {
                name: 'Power from Pain',
                description: 'Gain bonuses each turn: T1 - 6+ FNP, T2 - +1" Move, T3 - +1 Attack, etc.',
                detachmentRule: 'Realspace Raiders'
            },
            'chaos-marines': {
                name: 'Dark Pacts',
                description: 'Can make pacts with Chaos Gods for temporary bonuses at a cost.',
                detachmentRule: 'Let the Galaxy Burn'
            },
            'tyranids': {
                name: 'Synapse',
                description: 'Units within 6" of Synapse creatures automatically pass morale tests.',
                detachmentRule: 'Hive Mind'
            }
        };

        // Game State
        let gameState = {
            currentTurn: 1,
            currentPhase: 'command',
            activePlayer: 1,
            phases: ['command', 'movement', 'shooting', 'charge', 'fight', 'morale'],
            players: {
                1: { name: 'Player 1', cp: 3, vp: 0, faction: '', units: [] },
                2: { name: 'Player 2', cp: 3, vp: 0, faction: '', units: [] }
            },
            objectives: {
                1: { controlled: null, vp: 5 },
                2: { controlled: null, vp: 5 },
                3: { controlled: null, vp: 5 },
                4: { controlled: null, vp: 5 },
                5: { controlled: null, vp: 5 },
                6: { controlled: null, vp: 5 }
            },
            log: []
        };

        let currentUnitSelection = { player: 1, selectedUnits: [] };

        // Core functions
        function selectUnits() {
            currentUnitSelection.player = 1;
            currentUnitSelection.selectedUnits = [];
            showUnitModal(1);
        }

        function showUnitModal(playerNum) {
            const modal = document.getElementById('unitModal');
            const title = document.getElementById('modalTitle');
            const selector = document.getElementById('unitSelector');
            
            const playerName = document.getElementById(`player${playerNum}Name`).value;
            const faction = document.getElementById(`player${playerNum}Faction`).value;
            
            title.textContent = `Select Units for ${playerName}`;
            selector.innerHTML = '';
            
            const units = unitDatabase[faction] || [];
            
            units.forEach((unit, index) => {
                const unitDiv = document.createElement('div');
                unitDiv.className = 'unit-option';
                unitDiv.innerHTML = `
                    <div class="unit-name">${unit.name}</div>
                    <div style="font-size: 0.9rem; color: #ccc; margin-top: 0.5rem;">
                        <div>Models: ${unit.models} | Wounds: ${unit.wounds}/model</div>
                        <div>Save: ${unit.save}+ | Leadership: ${unit.leadership}</div>
                        <div>Role: ${unit.role}</div>
                    </div>
                `;
                
                unitDiv.addEventListener('click', () => {
                    unitDiv.classList.toggle('selected');
                    const selectedIndex = currentUnitSelection.selectedUnits.findIndex(u => u.index === index);
                    if (selectedIndex > -1) {
                        currentUnitSelection.selectedUnits.splice(selectedIndex, 1);
                    } else {
                        currentUnitSelection.selectedUnits.push({ ...unit, index, id: Date.now() + Math.random() });
                    }
                });
                selector.appendChild(unitDiv);
            });
            
            modal.style.display = 'block';
        }

        function confirmUnits() {
            const playerNum = currentUnitSelection.player;
            
            gameState.players[playerNum].units = [...currentUnitSelection.selectedUnits.map(unit => ({
                ...unit,
                currentWounds: unit.wounds * unit.models,
                maxWounds: unit.wounds * unit.models,
                currentModels: unit.models,
                buffs: [],
                status: 'active'
            }))];
            
            if (playerNum === 1) {
                currentUnitSelection.player = 2;
                currentUnitSelection.selectedUnits = [];
                closeUnitModal();
                showUnitModal(2);
            } else {
                closeUnitModal();
                logEntry('Army selection complete for both players');
            }
        }

        function closeUnitModal() {
            document.getElementById('unitModal').style.display = 'none';
        }

        function startGame() {
            gameState.players[1].name = document.getElementById('player1Name').value || 'Player 1';
            gameState.players[2].name = document.getElementById('player2Name').value || 'Player 2';
            gameState.players[1].faction = document.getElementById('player1Faction').value;
            gameState.players[2].faction = document.getElementById('player2Faction').value;
            
            document.getElementById('player1Name-display').textContent = gameState.players[1].name;
            document.getElementById('player2Name-display').textContent = gameState.players[2].name;
            
            if (gameState.players[1].units.length === 0) {
                addDefaultUnits(1);
            }
            if (gameState.players[2].units.length === 0) {
                addDefaultUnits(2);
            }
            
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'grid';
            
            updateDisplay();
            updateFactionRules();
            updateStratagemDisplay();
            logEntry(`Battle begins! ${gameState.players[1].name} vs ${gameState.players[2].name}`);
        }

        function addDefaultUnits(playerNum) {
            const faction = gameState.players[playerNum].faction;
            const units = unitDatabase[faction] || unitDatabase['space-marines'];
            
            gameState.players[playerNum].units = units.slice(0, 3).map(unit => ({
                ...unit,
                id: Date.now() + Math.random(),
                currentWounds: unit.wounds * unit.models,
                maxWounds: unit.wounds * unit.models,
                currentModels: unit.models,
                buffs: [],
                status: 'active'
            }));
        }

        function updateFactionRules() {
            const p1Faction = gameState.players[1].faction;
            const p2Faction = gameState.players[2].faction;
            const display = document.getElementById('factionRulesDisplay');
            
            let content = '';
            
            if (p1Faction && factionRules[p1Faction]) {
                const rule = factionRules[p1Faction];
                content += `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="color: #FFD700; font-size: 0.9rem;">${gameState.players[1].name} - ${rule.name}</h4>
                        <div style="font-size: 0.8rem; color: #ccc;">${rule.description}</div>
                    </div>
                `;
            }
            
            if (p2Faction && factionRules[p2Faction]) {
                const rule = factionRules[p2Faction];
                content += `
                    <div>
                        <h4 style="color: #FFD700; font-size: 0.9rem;">${gameState.players[2].name} - ${rule.name}</h4>
                        <div style="font-size: 0.8rem; color: #ccc;">${rule.description}</div>
                    </div>
                `;
            }
            
            if (display) {
                display.innerHTML = content || '<div style="font-size: 0.9rem; color: #ccc;">Select armies to see faction rules</div>';
            }
        }

        function updateStratagemDisplay() {
            const playerSelect = document.getElementById('stratagemPlayer');
            const phaseSelect = document.getElementById('stratagemPhase');
            const grid = document.getElementById('stratagemGrid');
            
            if (!playerSelect || !phaseSelect || !grid) return;
            
            const playerNum = parseInt(playerSelect.value);
            const selectedPhase = phaseSelect.value;
            const faction = gameState.players[playerNum].faction;
            
            const stratagems = stratagemDatabase[faction] || [];
            const filteredStratagems = stratagems.filter(s => 
                selectedPhase === 'any' || s.phase === 'any' || s.phase === selectedPhase
            );
            
            grid.innerHTML = '';
            
            filteredStratagems.forEach(stratagem => {
                const card = document.createElement('div');
                card.className = 'stratagem-card';
                card.innerHTML = `
                    <div class="stratagem-name">${stratagem.name}</div>
                    <div class="stratagem-cost">${stratagem.cost} CP</div>
                    <div class="stratagem-desc">${stratagem.description}</div>
                `;
                
                card.addEventListener('click', () => {
                    if (gameState.players[playerNum].cp >= stratagem.cost) {
                        gameState.players[playerNum].cp -= stratagem.cost;
                        logEntry(`${gameState.players[playerNum].name}: Used ${stratagem.name} (${stratagem.cost} CP)`);
                        updateDisplay();
                    } else {
                        logEntry(`${gameState.players[playerNum].name}: Not enough CP for ${stratagem.name}`);
                    }
                });
                grid.appendChild(card);
            });
            
            if (filteredStratagems.length === 0) {
                grid.innerHTML = '<div style="text-align: center; color: #888;">No stratagems available</div>';
            }
        }

        function toggleObjective(objNum) {
            const obj = gameState.objectives[objNum];
            const objElement = document.querySelector(`[data-obj="${objNum}"]`);
            
            if (obj.controlled === null) {
                obj.controlled = 1;
                objElement.className = 'objective player1';
                objElement.innerHTML = `Obj ${objNum}<br><span style="font-size: 0.7rem;">${gameState.players[1].name}</span>`;
            } else if (obj.controlled === 1) {
                obj.controlled = 2;
                objElement.className = 'objective player2';
                objElement.innerHTML = `Obj ${objNum}<br><span style="font-size: 0.7rem;">${gameState.players[2].name}</span>`;
            } else {
                obj.controlled = null;
                objElement.className = 'objective';
                objElement.innerHTML = `Obj ${objNum}<br><span style="font-size: 0.7rem;">Neutral</span>`;
            }
            
            logEntry(`Objective ${objNum} ${obj.controlled ? 'controlled by ' + gameState.players[obj.controlled].name : 'is now neutral'}`);
        }

        function rollToHit() {
            const unit = document.getElementById('hitUnit').value;
            const target = parseInt(document.getElementById('hitTarget').value);
            const dice = parseInt(document.getElementById('hitDice').value);
            
            if (!unit || !target || !dice) {
                logEntry('Combat: Please fill in all fields for hit rolls');
                return;
            }
            
            const rolls = [];
            let hits = 0;
            
            for (let i = 0; i < dice; i++) {
                const roll = Math.floor(Math.random() * 6) + 1;
                rolls.push(roll);
                if (roll >= target) hits++;
            }
            
            const visual = rolls.map(roll => 
                `<div class="die" style="background: ${roll >= target ? '#00FF00' : '#FF0000'}; color: ${roll >= target ? '#000' : '#FFF'}">${roll}</div>`
            ).join('');
            
            const resultsDiv = document.getElementById('diceResults');
            if (resultsDiv) {
                resultsDiv.innerHTML = `
                    <div><strong>Hit Rolls for ${unit}</strong></div>
                    <div class="dice-visual">${visual}</div>
                    <div><strong>${hits}/${dice} hits (need ${target}+)</strong></div>
                `;
            }
             class="form-group">
                        <label>Name:</label>
                        <input type="text" id="player1Name" placeholder="Enter name" value="Imperial Guard">
                    </div>
                    <div class="form-group">
                        <label>Faction:</label>
                        <select id="player1Faction">
                            <option value="space-marines">Space Marines</option>
                            <option value="imperial-guard" selected>Astra Militarum</option>
                            <option value="chaos-marines">Chaos Space Marines</option>
                            <option value="orks">Orks</option>
                            <option value="tau">T'au Empire</option>
                            <option value="necrons">Necrons</option>
                            <option value="eldar">Craftworld Eldar</option>
                            <option value="dark-eldar">Drukhari</option>
                            <option value="tyranids">Tyranids</option>
                        </select>
                    </div>
                </div>
                <div class="player-form">
                    <h3>Player 2</h3>
                    <div class="form-group">
                        <label>Name:</label>
                        <input type="text" id="player2Name" placeholder="Enter name" value="Space Marines">
                    </div>
                    <div class="form-group">
                        <label>Faction:</label>
                        <select id="player2Faction">
                            <option value="space-marines" selected>Space Marines</option>
                            <option value="imperial-guard">Astra Militarum</option>
                            <option value="chaos-marines">Chaos Space Marines</option>
                            <option value="orks">Orks</option>
                            <option value="tau">T'au Empire</option>
                            <option value="necrons">Necrons</option>
                            <option value="eldar">Craftworld Eldar</option>
                            <option value="dark-eldar">Drukhari</option>
                            <option value="tyranids">Tyranids</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="setup-buttons">
                <button class="btn" onclick="selectUnits()">üî´ Select Army Units</button>
                <button class="btn btn-secondary" onclick="startGame()">‚ö° Start Battle</button>
            </div>
        </div>
    </div>

    <!-- Unit Selection Modal -->
    <div id="unitModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeUnitModal()">&times;</span>
            <h2 id="modalTitle">Select Units for Player</h2>
            <div id="unitSelector" class="unit-selector"></div>
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn" onclick="confirmUnits()">‚úÖ Confirm Selection</button>
                <button class="btn btn-secondary" onclick="closeUnitModal()">‚ùå Cancel</button>
            </div>
        </div>
    </div>

    <!-- Main Game Screen -->
    <div id="gameScreen" class="game-container">
        <div class="main-game">
            <!-- Phase Tracker -->
            <div class="phase-tracker">
                <div class="phase-bar">
                    <div class="phase active" data-phase="command">Command</div>
                    <div class="phase" data-phase="movement">Movement</div>
                    <div class="phase" data-phase="shooting">Shooting</div>
                    <div class="phase" data-phase="charge">Charge</div>
                    <div class="phase" data-phase="fight">Fight</div>
                    <div class="phase" data-phase="morale">Morale</div>
                </div>
                <div class="turn-info">
                    <span>üéØ Turn: <span id="currentTurn">1</span></span>
                    <span>üëë Active Player: <span id="activePlayer">Player 1</span></span>
                    <div>
                        <button class="btn" onclick="nextPhase()">‚û°Ô∏è Next Phase</button>
                        <button class="btn btn-secondary" onclick="endTurn()">üîÑ End Turn</button>
                    </div>
                </div>
            </div>

            <!-- Players Area -->
            <div class="players-area">
                <!-- Player 1 Panel -->
                <div class="player-panel active" id="player1Panel">
                    <div class="player-header">
                        <div class="player-avatar">P1</div>
                        <div class="player-stats">
                            <div class="stat-row">
                                <span>üèÜ <span id="player1Name-display">Player 1</span></span>
                            </div>
                            <div class="stat-row">
                                <span>‚ö° CP: <span id="player1CP">3</span></span>
                                <span>üéØ VP: <span id="player1VP">0</span></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="units-section">
                        <h4>üõ°Ô∏è Army Units</h4>
                        <div id="player1Units"></div>
                    </div>

                    <div class="actions-section">
                        <h4>‚öîÔ∏è Actions</h4>
                        <div class="action-input">
                            <input type="text" id="player1Input" placeholder="Enter action (e.g., 'Guardsman takes 2 wounds', 'spend 1 CP')" />
                            <button class="btn" onclick="processAction(1)">Execute</button>
                        </div>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem;">
                            <button class="btn btn-secondary" onclick="quickAction(1, 'spend-cp')">-1 CP</button>
                            <button class="btn btn-secondary" onclick="quickAction(1, 'gain-vp')">+1 VP</button>
                            <button class="btn btn-secondary" onclick="quickAction(1, 'overwatch')">Overwatch</button>
                        </div>
                    </div>
                </div>

                <!-- Player 2 Panel -->
                <div class="player-panel" id="player2Panel">
                    <div class="player-header">
                        <div class="player-avatar">P2</div>
                        <div class="player-stats">
                            <div class="stat-row">
                                <span>üèÜ <span id="player2Name-display">Player 2</span></span>
                            </div>
                            <div class="stat-row">
                                <span>‚ö° CP: <span id="player2CP">3</span></span>
                                <span>üéØ VP: <span id="player2VP">0</span></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="units-section">
                        <h4>üõ°Ô∏è Army Units</h4>
                        <div id="player2Units"></div>
                    </div>

                    <div class="actions-section">
                        <h4>‚öîÔ∏è Actions</h4>
                        <div class="action-input">
                            <input type="text" id="player2Input" placeholder="Enter action (e.g., 'Space Marine takes 1 wound', 'use Transhuman')" />
                            <button class="btn" onclick="processAction(2)">Execute</button>
                        </div>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem;">
                            <button class="btn btn-secondary" onclick="quickAction(2, 'spend-cp')">-1 CP</button>
                            <button class="btn btn-secondary" onclick="quickAction(2, 'gain-vp')">+1 VP</button>
                            <button class="btn btn-secondary" onclick="quickAction(2, 'overwatch')">Overwatch</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Faction Rules -->
            <div class="faction-rules">
                <h3>üìú Faction Rules</h3>
                <div id="factionRulesDisplay">
                    <div style="font-size: 0.9rem; color: #ccc;">Select armies to see faction rules</div>
                </div>
            </div>

            <!-- Stratagems -->
            <div class="stratagem-section">
                <h3>‚ö° Stratagems</h3>
                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <select id="stratagemPlayer" style="flex: 1; padding: 0.25rem; background: rgba(255,255,255,0.1); color: #fff; border: 1px solid #666; border-radius: 3px;">
                        <option value="1">Player 1</option>
                        <option value="2">Player 2</option>
                    </select>
                    <select id="stratagemPhase" style="flex: 1; padding: 0.25rem; background: rgba(255,255,255,0.1); color: #fff; border: 1px solid #666; border-radius: 3px;">
                        <option value="any">Any Phase</option>
                        <option value="command">Command</option>
                        <option value="movement">Movement</option>
                        <option value="shooting">Shooting</option>
                        <option value="charge">Charge</option>
                        <option value="fight">Fight</option>
                        <option value="morale">Morale</option>
                    </select>
                </div>
                <div class="stratagem-grid" id="stratagemGrid"></div>
            </div>

            <!-- Objectives -->
            <div class="objective-tracker">
                <h3>üéØ Objectives</h3>
                <div class="objective-grid">
                    <div class="objective" data-obj="1" onclick="toggleObjective(1)">Obj 1<br><span style="font-size: 0.7rem;">Neutral</span></div>
                    <div class="objective" data-obj="2" onclick="toggleObjective(2)">Obj 2<br><span style="font-size: 0.7rem;">Neutral</span></div>
                    <div class="objective" data-obj="3" onclick="toggleObjective(3)">Obj 3<br><span style="font-size: 0.7rem;">Neutral</span></div>
                    <div class="objective" data-obj="4" onclick="toggleObjective(4)">Obj 4<br><span style="font-size: 0.7rem;">Neutral</span></div>
                    <div class="objective" data-obj="5" onclick="toggleObjective(5)">Obj 5<br><span style="font-size: 0.7rem;">Neutral</span></div>
                    <div class="objective" data-obj="6" onclick="toggleObjective(6)">Obj 6<br><span style="font-size: 0.7rem;">Neutral</span></div>
                </div>
            </div>

            <!-- Combat Tracker -->
            <div class="combat-tracker">
                <h3>‚öîÔ∏è Combat Assistant</h3>
                <div class="combat-roll-section">
                    <div class="roll-category">
                        <h4 style="color: #FFD700; font-size: 0.9rem;">Hit Rolls</h4>
                        <div class="roll-inputs">
                            <input type="text" placeholder="Unit name" id="hitUnit">
                            <input type="text" placeholder="WS/BS" id="hitTarget">
                            <input type="text" placeholder="# dice" id="hitDice">
                        </div>
                        <button class="btn" style="width: 100%; margin-top: 0.5rem; padding: 0.25rem;" onclick="rollToHit()">Roll to Hit</button>
                    </div>
                    <div